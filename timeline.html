<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Mi Timeline (CDN)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- CSS desde CDN (dist) -->
 <link rel="stylesheet" href="https://unpkg.com/@knight-lab/timelinejs/dist/css/timeline.css" crossorigin="anonymous">

  <style>
    html,body{height:100%;margin:0}
    #timeline-embed{width:100%;height:100vh}
  </style>
</head>
<body>
  <div id="timeline-embed">Cargando timeline…</div>

  <!-- JS desde CDN (dist) -->
  <script src="https://unpkg.com/@knight-lab/timelinejs/dist/timeline.js" crossorigin="anonymous"></script>

  <script>
    const jsonPath = 'data/story.json'; // ruta en tu repo /data/story.json

    // función que intenta detectar la API disponible y construye el timeline
    function createTimelineFromObject(data) {
      // new Timeline(...) is the ES module/class API from TimelineJS3
      if (typeof window.Timeline === 'function') {
        // new Timeline(containerElOrId, dataOrUrl, options)
        new window.Timeline('timeline-embed', data, { language: 'es' });
        return;
      }
      // backward-compat: TL.Timeline (older UMD build)
      if (window.TL && typeof window.TL.Timeline === 'function') {
        new window.TL.Timeline('timeline-embed', data, { language: 'es' });
        return;
      }
      // si no hay constructor conocido, reportamos
      document.getElementById('timeline-embed').innerHTML =
        '<div style="padding:20px;color:#900">La librería Timeline no está disponible (comprueba el script CDN).</div>';
    }

    async function init() {
      try {
        const res = await fetch(jsonPath, {cache: 'no-store'});
        if (!res.ok) throw new Error('HTTP ' + res.status + ' al cargar ' + jsonPath);
        const contentType = res.headers.get('content-type') || '';
        if (!contentType.includes('application/json')) {
          console.warn('Respuesta content-type:', contentType);
        }
        const data = await res.json();

        // validación mínima
        if (!data || !data.timeline || !Array.isArray(data.timeline.date) || data.timeline.date.length === 0) {
          throw new Error('timeline.date vacío o inválido en ' + jsonPath);
        }

        createTimelineFromObject(data);

      } catch (err) {
        console.error(err);
        document.getElementById('timeline-embed').innerHTML =
          '<div style="padding:20px;color:#900">Error al cargar timeline: ' + err.message + '</div>';
      }
    }

    // si la librería ya carga en window, init; si tarda, espera al load
    if (typeof window.Timeline === 'function' || (window.TL && typeof window.TL.Timeline === 'function')) {
      init();
    } else {
      window.addEventListener('load', init);
    }
  </script>
</body>
</html>
